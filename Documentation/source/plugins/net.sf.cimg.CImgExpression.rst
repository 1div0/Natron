GMICExpr
========

.. figure:: net.sf.cimg.CImgExpression.png
   :alt: 

*This documentation is for version 2.1 of GMICExpr.*

Quickly generate or process image from mathematical formula evaluated for each pixel. Full documentation for G'MIC/CImg expressions can be found at http://gmic.eu/reference.shtml#section9 The only difference is the predefined variables 't' (current time) and 'k' (render scale).

The mathematical parser understands the following set of functions, operators and variables: \_ Usual operators: \|\| (logical or), && (logical and), \| (bitwise or), & (bitwise and), !=, ==, <=, >=, <, >, << (left bitwise shift), >> (right bitwise shift), -, +, \*, /, % (modulo), ^ (power), ! (logical not), ~ (bitwise not). \_ Usual functions: sin(), cos(), tan(), asin(), acos(), atan(), sinh(), cosh(), tanh(), log(), log2(), log10(), exp(), sign(), abs(), atan2(), round(), narg(), arg(), isval(), isnan(), isinf(), isint(), isbool(), isdir(), isfile(), rol() (left bit rotation), ror() (right bit rotation), min(), max(), med(), kth(), sinc(), int(). . Function 'atan2()' is the version of 'atan()' with two arguments 'y' and 'x' (as in C/C++). . Function 'hypoth(x,y)' computes the square root of the sum of the squares of x and y. . Function 'normP(u1,...,un)' computes the LP-norm of the specified vector (P being an unsigned integer or 'inf'). . Function 'narg()' returns the number of
specified arguments. . Function 'arg(i,a\_1,..,a\_n)' returns the ith argument a\_i. . Functions 'min()', 'max()', 'med()' and 'kth()' can be called with an arbitrary number of arguments. . Function 'dowhile(expression)' repeats the evaluation of the expression until it vanishes. It can be used to compute mathematical series. For instance the expression: 'if(N<2,N,n=N-1;F0=0;F1=1;dowhile(F2=F0+F1;F0=F1;F1=F2;n=n-1);F2)' returns the Nth value of the Fibonacci sequence, for N>=0 (e.g., 46368 for N=24). 'dowhile(expression)' always evaluates the specified expression at least once, then check for the nullity condition. It always returns 0 when done. . Function 'for(init,condition,expression)' first evaluates the expression 'init', then iteratively evaluates 'expression' while 'condition' is verified. it may happen that no iteration is done, in which case the function returns 0. Otherwise, it returns the last value of 'expression'. For instance, the expression:
'if(N<2,N,for(n=N;F0=0;F1=1,n=n-1,F2=F0+F1;F0=F1;F1=F2))' returns the Nth value of the Fibonacci sequence, for N>=0 (e.g., 46368 for N=24). . Functions 'isval()', 'isnan()', 'isinf()', 'isbool()' can be used to test the type of a given number or expression. . Function 'isfile()' (resp. 'isdir()') returns 0 (false) or 1 (true) whether its argument is a valid path to a file (resp. to a directory) or not. . Function 'isin(v,a\_1,...,a\_n)' returns 0 (false) or 1 (true) whether the first value 'v' appears in the set of other values 'a\_i'. . Function 'fdate(path,attr)' returns the date attribute for the given 'path' (file or directory), with 'attr' being { 0=year \| 1=month \| 2=day \| 3=day of week \| 4=hour \| 5=minute \| 6=second }. . Function 'date(attr) returns the specified attribute for the current (locale) date (same meaning as fdate()).

::

    _ Variable names below are pre-defined. They can be overloaded.
         . 'w': width of the associated image, if any (0 otherwise).
         . 'h': height of the associated image, if any (0 otherwise).
         . 'd': depth of the associated image, if any (0 otherwise).
         . 's': spectrum of the associated image, if any (0 otherwise).
         . 'r': shared state of the associated image, if any (0 otherwise).
         . 'wh': shortcut for width*height.
         . 'whd': shortcut for width*height*depth.
         . 'whds': shortcut for width*height*depth*spectrum (i.e. total number of pixel values).
         . 'x': current processed column of the associated image, if any (0 otherwise).
         . 'y': current processed row of the associated image, if any (0 otherwise).
         . 'z': current processed slice of the associated image, if any (0 otherwise).
         . 'c': current processed channel of the associated image, if any (0 otherwise).
         . 't': current time [OpenFX-only].
         . 'k': render scale (1 means full scale, 0.5 means half scale) [OpenFX-only].
         . 'e': value of e, i.e. 2.71828..
         . 'pi': value of pi, i.e. 3.1415926..
         . '?' or 'u': a random value between [0,1], following a uniform distribution.
         . 'g': a random value, following a gaussian distribution of variance 1 (roughly in [-5,5]).
         . 'i': current processed pixel value (i.e. value located at (x,y,z,c)) of the
            associated image, if any (0 otherwise).
         . 'im','iM','ia','iv','ic': Respectively the minimum, maximum, average values,
            variance and median value of the associated image, if any (0 otherwise).
         . 'xm','ym','zm','cm': The pixel coordinates of the minimum value in the associated
            image, if any (0 otherwise).
         . 'xM','yM','zM','cM': The pixel coordinates of the maximum value in the
            associated image, if any (0 otherwise).

    _ Special operators can be used:
         . ';': expression separator. The returned value is always the last encountered
            expression. For instance expression '1;2;pi' is evaluated as 'pi'.
         . '=': variable assignment. Variables in mathematical parser can only refer to
            numerical values. Variable names are case-sensitive. Use this operator in
            conjunction with ';' to define complex evaluable expressions, such as
            't=cos(x);3*t^2+2*t+1'.
            These variables remain local to the mathematical parser and cannot be accessed
            outside the evaluated expression.

    _ The following specific functions are also defined:
         . 'if(expr_cond,expr_then,expr_else)': return value of 'expr_then' or 'expr_else',
            depending on the value of 'expr_cond' (0=false, other=true). For instance,
            GMICExpr command 'if(x%10==0,255,i)' will draw blank vertical lines on every
            10th column of an image.
         . '?(max)' or '?(min,max)': return a random value between [0,max] or [min,max],
            following a uniform distribution. 'u(max)' and 'u(0,max)' mean the same.
         . 'i(_a,_b,_c,_d,_interpolation,_boundary)': return the value of the pixel located
            at position (a,b,c,d) in the associated image, if any (0 otherwise).
            Interpolation parameter can be { 0=nearest neighbor | other=linear }.
            Boundary conditions can be { 0=dirichlet | 1=neumann | 2=periodic }.
            Omitted coordinates are replaced by their default values which are respectively
            x, y, z, c and 0.
         . 'j(_dx,_dy,_dz,_dc,_interpolation,_boundary)': does the same for the pixel located
            at position (x+dx,y+dy,z+dz,c+dc).
         . 'i[offset]': return the value of the pixel located at specified offset in the associated
            image buffer.
         . 'j[offset]': does the same for an offset relative to the current pixel (x,y,z,c).
            For instance expression '0.5*(i(x+1)-i(x-1))' will estimate the X-derivative
            of an image with a classical finite difference scheme.
         . If specified formula starts with '>' or '<', the operators 'i(..)' and 'j(..)' will return
            values of the image currently being modified, in forward ('>') or backward ('<') order.

Sample expressions:

'j(sin(y/100/k+t/10)*20*\ k,sin(x/100/k+t/10)\ *20*\ k)' distorts the image with time-varying waves.

'0.5\*(j(1)-j(-1))' will estimate the X-derivative of an image with a classical finite difference scheme.

'if(x%10==0,1,i)' will draw blank vertical lines on every 10th column of an image.

'X=x-w/2;Y=y-h/2;D=sqrt(X:sup:`2+Y`\ 2);if(D+u\ *20<80,abs(cos(D/(5+c))),10*\ (y%(20+c))/255)'

'X=x-w/2;Y=y-h/2;D=sqrt(X:sup:`2+Y`\ 2);if(D+u\ *20<80,abs(cos(D/(5+c))),10*\ (y%(20+c))/255)'

'sqrt(zr=-1.2+2.4*x/w;zi=-1.2+2.4*\ y/h;for(i=0,zr\ *zr+zi*\ zi<=4&&i<256,t=zr\ *zr-zi*\ zi+0.4;zi=2\ *zr*\ zi+0.2;zr=t; i=i+1))/255' draws the Mandelbrot fractal (give it a 1024x1024 image as input).

Uses the 'fill' function from the CImg library. CImg is a free, open-source library distributed under the CeCILL-C (close to the GNU LGPL) or CeCILL (compatible with the GNU GPL) licenses. It can be used in commercial applications (see http://cimg.sourceforge.net).

Inputs & Controls
-----------------

+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Label (UI Name)                | Script-Name              | Default-Value   | Function                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
+================================+==========================+=================+===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
| Source                         |                          |                 | Source                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Mask                           |                          |                 | Mask                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Controls                       | Controls                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| R                              | NatronOfxParamProcessR   | On              | Process red component.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| G                              | NatronOfxParamProcessG   | On              | Process green component.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| B                              | NatronOfxParamProcessB   | On              | Process blue component.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| A                              | NatronOfxParamProcessA   | Off             | Process alpha component.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Expression                     | expression               | i               | G'MIC/CImg expression, see the plugin description/help, or http://gmic.eu/reference.shtml#section9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Help                           | help                     | N/A             | Display help for writing GMIC expressions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| (Un)premult                    | premult                  | Off             | Divide the image by the alpha channel before processing, and re-multiply it afterwards. Use if the input images are premultiplied.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Invert Mask                    | maskInvert               | Off             | When checked, the effect is fully applied where the mask is 0.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Mix                            | mix                      | 1               | Mix factor between the original and the transformed image.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Node                           | Node                     |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Label                          | userTextArea             | N/A             | This label gets appended to the node name on the node graph.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Output Layer                   | channels                 | Color.RGBA      | Select here the layer onto which the processing should occur.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Mask                           | enableMask\_Mask         | Off             | Enable the mask to come from the channel named by the choice parameter on the right. Turning this off will act as though the mask was disconnected.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                | maskChannel\_Mask        | RGBA.A          | Use this channel from the original input to mix the output with the original input. Setting this to None is the same as disconnecting the input.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                | advancedSep              | N/A             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Hide inputs                    | hideInputs               | Off             | When checked, the input arrows of the node in the nodegraph will be hidden                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Force caching                  | forceCaching             | Off             | When checked, the output of this node will always be kept in the RAM cache for fast access of already computed images.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Preview                        | enablePreview            | Off             | Whether to show a preview on the node box in the node-graph.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Disable                        | disableNode              | Off             | When disabled, this node acts as a pass through.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Lifetime Range                 | nodeLifeTime             | x: 0 y: 0       | This is the frame range during which the node will be active if Enable Lifetime is checked                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Enable Lifetime                | enableNodeLifeTime       | Off             | When checked, the node is only active during the specified frame range by the Lifetime Range parameter. Outside of this frame range, it behaves as if the Disable parameter is checked                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| After param changed callback   | onParamChanged           | N/A             | Set here the name of a function defined in Python which will be called for each parameter change. Either define this function in the Script Editor or in the init.py script or even in the script of a Python group plug-in.The signature of the callback is: callback(thisParam, thisNode, thisGroup, app, userEdited) where:- thisParam: The parameter which just had its value changed- userEdited: A boolean informing whether the change was due to user interaction or because something internally triggered the change.- thisNode: The node holding the parameter- app: points to the current application instance- thisGroup: The group holding thisNode (only if thisNode belongs to a group)   |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| After input changed callback   | onInputChanged           | N/A             | Set here the name of a function defined in Python which will be called after each connection is changed for the inputs of the node. Either define this function in the Script Editor or in the init.py script or even in the script of a Python group plug-in.The signature of the callback is: callback(inputIndex, thisNode, thisGroup, app):- inputIndex: the index of the input which changed, you can query the node connected to the input by calling the getInput(...) function.- thisNode: The node holding the parameter- app: points to the current application instance- thisGroup: The group holding thisNode (only if thisNode belongs to a group)                                           |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Info                           | Info                     |                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                | nodeInfos                | N/A             | Input and output informations, press Refresh to update them with current values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Refresh Info                   | refreshButton            | N/A             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+--------------------------------+--------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
